# 인그레스(Ingress)
- 인그레스는 사전적으로 외부에서 내부로 향하는 것을 의미한다.
  - 인그레스 트래픽은 외부에서 서버로 유입되는 트래픽이다.
  - 인그레스 네트워크는 인그레스 트래픽을 처리하기 위한 네트워크이다.
- 쿠버네티스에서 인그레스는 외부 요청을 어떻게 처리할 것인지를 네트워크 7계층 레벨에서 정의하는 오브젝트이다.
- 인그레스 오브젝트가 담당할 수 있는 기본 기능은 다음과 같다.
  - **외부 요청의 라우팅**
    - 특정 경로로 들어온 요청을 어떠한 서비스로 전달할지 정의하는 라우팅 규칙을 설정한다.
  - **가상 호스트 기반의 요청 처리**
    - 같은 IP에 대해 다른 도메인 이름으로 요청이 도착했을 때, 어떻게 처리할 것인지를 정의한다.
  - **SSL/TLS 보안 연결 처리**
    - 여러 개의 서비스로 요청을 라우팅 할 때, 보안 연결을 위한 인증서를 적용한다.

## 1. 인그레스를 사용하는 이유
- 예를 들어, 인그레스를 사용하지 않을 경우 애플리케이션이 3개의 디플로이먼트로 생성되어 있을 때, 각 디플로이먼트를 외부에 노출해야 한다면 NodePort나 LoadBalancer 타입의 서비스 3개를 생성한다.
- 위의 방식은 서비스마다 세부적인 설정을 할 때 추가적인 복잡성이 발생한다.
  - SSL/TLS 보안 연결, 접근 도메인 및 클라이언트 상테에 기반한 라우팅 등을 구현하려면 각 서비스와 디플로이먼트에 대해 일일히 설정을 해야 하기 때문이다.
- 인스레스 오브젝트를 사용하면 URL 엔드포인트를 단 하나만 생성함으로써 쉽게 해결할 수 있다.
  - 클라이언트는 인그레스의 URL로만 접근하게 되며, 해당 요청은 인그레스에서 정의한 규칙에 따라 처리된 뒤 적절한 디플로이먼트의 포드로 전달된다.
- 외부 요청에 대한 처리 규칙을 쿠버네티스 자체의 기능으로 편리하게 관리할 수 있다는 것이 인그레스의 핵심이다.

## 2. 인그레스의 구조
- `kubectl get ingress` 명령어로 인그레스의 목록을 확인할 수 있다.
  - **ingress**는 **ing**로 줄일 수 있다.
- 인그레스를 생성하려면 YAML 파일로 인그레스를 정의한다.
```yaml
apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: ingress-example
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    kubernetes.io/ingress.class: "nginx"
spec:
  rules:
  - host: gowns764.example.com
    http:
      paths:
      - path: /echo-hostname
        backend:
          serviceName: hostname-service
          servicePort: 80
```
- **host**
  - 해당 도메인으로 접근하는 요청에 대해서 처리 규칙을 적용한다.
  - 여러 개의 host를 정의하여 사용할 수 있다.
- **path**
  - 해당 경로에 들어온 요청을 어느 서비스로 전달할 것인지를 정의한다.
  - 여러 개의 path를 정의하여 경로를 처리할 수 있다.
- **serviceName, servicePort**
  - path로 들어온 요청이 전달될 서비스와 포트이다.
- 인그레스는 단지 요청을 처리하는 규칙을 정의하는 선언적인 오브젝트일 뿐, 외부 요청을 받아들일 수 있는 실제 서버가 아니기 때문에, 그저 인그레스만 생성하면 아무 일도 일어나지 않는다.
  - 인그레스는 **인그레스 컨트롤러**라는 특수한 서버에 적용해야만 규칙을 사용할 수 있다.
  - 즉, 실제로 외부 요청을 받아들이는 것은 인그레스 컨트롤러 서버이며, 이 서버가 인그레스 규칙을 로드하여 사용한다.